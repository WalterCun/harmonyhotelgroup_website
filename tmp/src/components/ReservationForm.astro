---
// ReservationForm.astro - Reservation form component with WhatsApp integration
---

<!-- Flatpickr CSS and JS from CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script is:inline src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script is:inline src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>

<div class="bg-white dark:bg-harmony-black-800 bg-opacity-90 dark:bg-opacity-90 p-6 rounded-lg shadow-lg w-4/5 mx-auto" x-data="reservationForm">
  <h2 class="text-2xl font-serif text-harmony-black-700 dark:text-white mb-6 text-center">Reserva tu estancia</h2>

  <form class="space-y-4" @submit.prevent="window.open(generateWhatsAppLink(), '_blank')">
    <!-- Single row for dates, adults, and children -->
    <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
      <!-- Date pickers (Check-in and Check-out) -->
      <div class="md:col-span-6 grid grid-cols-2 gap-3" x-init="initDatepickers()">
        <!-- Check-in date picker -->
        <div>
          <label for="check-in-date" class="block text-harmony-black-700 dark:text-white font-medium mb-1">Entrada</label>
          <div class="relative">
            <input 
              type="text" 
              id="check-in-date" 
              placeholder="Fecha de entrada"
              class="w-full px-3 py-2 border border-harmony-white-500 dark:border-harmony-black-600 bg-white dark:bg-harmony-black-700 text-harmony-black-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-harmony-gold-400"
              required
              readonly
            >
          </div>
        </div>

        <!-- Check-out date picker -->
        <div>
          <label for="check-out-date" class="block text-harmony-black-700 dark:text-white font-medium mb-1">Salida</label>
          <div class="relative">
            <input 
              type="text" 
              id="check-out-date" 
              placeholder="Fecha de salida"
              class="w-full px-3 py-2 border border-harmony-white-500 dark:border-harmony-black-600 bg-white dark:bg-harmony-black-700 text-harmony-black-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-harmony-gold-400"
              required
              readonly
            >
          </div>
        </div>

        <!-- Custom styling for Flatpickr -->
        <style>
          .flatpickr-calendar {
            width: auto !important;
          }
          .flatpickr-calendar.open {
            z-index: 9999;
          }
          .flatpickr-months .flatpickr-month {
            background-color: #d4b33f;
          }
          .flatpickr-current-month .flatpickr-monthDropdown-months,
          .flatpickr-current-month .numInputWrapper {
            color: white;
          }
          .flatpickr-weekday {
            color: #404040;
          }
          .flatpickr-day.selected, 
          .flatpickr-day.startRange, 
          .flatpickr-day.endRange, 
          .flatpickr-day.selected.inRange, 
          .flatpickr-day.startRange.inRange, 
          .flatpickr-day.endRange.inRange, 
          .flatpickr-day.selected:focus, 
          .flatpickr-day.startRange:focus, 
          .flatpickr-day.endRange:focus, 
          .flatpickr-day.selected:hover, 
          .flatpickr-day.startRange:hover, 
          .flatpickr-day.endRange:hover {
            background: #d4b33f;
            border-color: #d4b33f;
          }
          .flatpickr-day.selected.startRange + .endRange:not(:nth-child(7n+1)), 
          .flatpickr-day.startRange.startRange + .endRange:not(:nth-child(7n+1)), 
          .flatpickr-day.endRange.startRange + .endRange:not(:nth-child(7n+1)) {
            box-shadow: -10px 0 0 #d4b33f;
          }
          .flatpickr-day.inRange {
            background: #f5d76e;
            border-color: #f5d76e;
          }
        </style>
      </div>

      <!-- Number of adults -->
      <div class="md:col-span-3">
        <label for="adults" class="block text-harmony-black-700 dark:text-white font-medium mb-1">Adultos</label>
        <select 
          id="adults" 
          x-model="adults"
          class="w-full px-3 py-2 border border-harmony-white-500 dark:border-harmony-black-600 bg-white dark:bg-harmony-black-700 text-harmony-black-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-harmony-gold-400"
        >
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
        </select>
      </div>

      <!-- Number of children -->
      <div class="md:col-span-3">
        <label for="children" class="block text-harmony-black-700 dark:text-white font-medium mb-1">Niños</label>
        <select 
          id="children" 
          x-model="children"
          @change="updateChildrenAges()"
          class="w-full px-3 py-2 border border-harmony-white-500 dark:border-harmony-black-600 bg-white dark:bg-harmony-black-700 text-harmony-black-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-harmony-gold-400"
        >
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
        </select>
      </div>
    </div>

    <!-- Children ages (dynamic) -->
    <div x-show="children > 0" class="space-y-3 animate-fade-in">
      <p class="text-harmony-black-700 dark:text-white font-medium">Edad de los niños</p>
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
        <template x-for="(age, index) in childrenAges" :key="index">
          <div>
            <label :for="'child-age-' + index" class="block text-harmony-black-600 dark:text-harmony-white-600 text-sm mb-1" x-text="`Niño ${index + 1}`"></label>
            <select 
              :id="'child-age-' + index" 
              x-model="childrenAges[index]"
              class="w-full px-3 py-2 border border-harmony-white-500 dark:border-harmony-black-600 bg-white dark:bg-harmony-black-700 text-harmony-black-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-harmony-gold-400"
            >
              <option value="">Seleccionar</option>
              <option value="0">Menos de 1 año</option>
              <option value="1">1 año</option>
              <option value="2">2 años</option>
              <option value="3">3 años</option>
              <option value="4">4 años</option>
              <option value="5">5 años</option>
              <option value="6">6 años</option>
              <option value="7">7 años</option>
              <option value="8">8 años</option>
              <option value="9">9 años</option>
              <option value="10">10 años</option>
              <option value="11">11 años</option>
              <option value="12">12 años</option>
              <option value="13">13 años</option>
              <option value="14">14 años</option>
              <option value="15">15 años</option>
              <option value="16">16 años</option>
              <option value="17">17 años</option>
            </select>
          </div>
        </template>
      </div>
    </div>

    <!-- Additional options -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
      <!-- Breakfast option -->
      <div class="flex items-center">
        <input 
          type="checkbox" 
          id="breakfast" 
          x-model="breakfast"
          class="h-5 w-5 text-harmony-gold-500 focus:ring-harmony-gold-400 border-harmony-white-500 rounded"
        >
        <label for="breakfast" class="ml-2 block text-harmony-black-700 dark:text-white">Incluir desayuno</label>
      </div>

      <!-- Parking option -->
      <div class="flex items-center">
        <input 
          type="checkbox" 
          id="parking" 
          x-model="parking"
          class="h-5 w-5 text-harmony-gold-500 focus:ring-harmony-gold-400 border-harmony-white-500 rounded"
        >
        <label for="parking" class="ml-2 block text-harmony-black-700 dark:text-white">Parqueadero</label>
      </div>
    </div>

    <div class="pt-2">
      <button 
        type="submit"
        class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-md transition-colors duration-300 flex items-center justify-center"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" />
        </svg>
        Reservar por WhatsApp
      </button>
    </div>
  </form>
</div>
